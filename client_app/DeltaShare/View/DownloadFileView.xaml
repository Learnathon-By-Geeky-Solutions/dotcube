<?xml version="1.0" encoding="utf-8" ?>
<ContentPage
    x:Class="DeltaShare.View.DownloadFileView"
    xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
    xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
    xmlns:model="clr-namespace:DeltaShare.Model"
    xmlns:viewmodel="clr-namespace:DeltaShare.ViewModel"
    Title=""
    x:DataType="viewmodel:DownloadFileViewModel"
    Shell.ForegroundColor="{StaticResource Grad1}">
    <Shell.TitleView>
        <Grid ColumnDefinitions="*,Auto" RowDefinitions="*">
            <Button
                x:Name="inviteBtn"
                Grid.Row="0"
                Grid.Column="0"
                Margin="0,4,16,0"
                Padding="16,0,16,0"
                FontSize="15"
                HorizontalOptions="End"
                IsEnabled="False"
                Text="Invite others"
                TextColor="White"
                WidthRequest="160">
                <Button.ImageSource>
                    <FontImageSource
                        FontFamily="FASolid"
                        Glyph="&#xf029;"
                        Size="20"
                        Color="{AppThemeBinding Light={StaticResource White},
                                                Dark={StaticResource PrimaryDarkText}}" />
                </Button.ImageSource>
            </Button>
            <Button
                x:Name="refreshBtn"
                Grid.Row="0"
                Grid.Column="1"
                Margin="0,4,16,0"
                Padding="16,0,16,0"
                Command="{Binding ClickRefreshBtnCommand}"
                HorizontalOptions="End"
                Text="">
                <Button.ImageSource>
                    <FontImageSource
                        FontFamily="FASolid"
                        Glyph="&#xf2f9;"
                        Color="{AppThemeBinding Light={StaticResource White},
                                                Dark={StaticResource PrimaryDarkText}}" />
                </Button.ImageSource>
            </Button>
        </Grid>
    </Shell.TitleView>
    <Grid
        Padding="16,16"
        ColumnSpacing="16"
        RowDefinitions="Auto,Auto,*,Auto"
        RowSpacing="4">
        <CollectionView
            Grid.Row="0"
            ItemsLayout="HorizontalList"
            ItemsSource="{Binding PoolUsers}"
            SelectionMode="None">
            <CollectionView.ItemTemplate>
                <DataTemplate x:DataType="model:User">
                    <VerticalStackLayout>
                        <Border
                            Margin="0,0,0,0"
                            Background="Transparent"
                            HeightRequest="60"
                            Stroke="{StaticResource Grad1}"
                            StrokeShape="RoundRectangle 20,20,20,20"
                            StrokeThickness="4"
                            WidthRequest="60">
                            <Image Aspect="AspectFit" Source="user.png" />
                        </Border>
                        <Label
                            Margin="4,0,4,0"
                            FontAttributes="Bold"
                            HorizontalOptions="Center"
                            HorizontalTextAlignment="Center"
                            Text="{Binding ViewableUsername}" />
                    </VerticalStackLayout>
                </DataTemplate>
            </CollectionView.ItemTemplate>
        </CollectionView>
        <Grid Grid.Row="1" ColumnDefinitions="Auto,*">
            <Label
                Grid.Column="0"
                FontAttributes="Bold"
                FontSize="18"
                Text="Shared Files"
                TextColor="{StaticResource Grad1}"
                VerticalOptions="Center" />
            <Border
                Grid.Column="1"
                Margin="10,0,0,0"
                HeightRequest="18"
                Stroke="Transparent"
                StrokeShape="RoundRectangle 10"
                VerticalOptions="Center">
                <Border.Background>
                    <LinearGradientBrush>
                        <GradientStop Offset="0" Color="{StaticResource Grad1}" />
                        <GradientStop Offset="1" Color="{StaticResource Grad2}" />
                    </LinearGradientBrush>
                </Border.Background>
            </Border>
        </Grid>
        <CollectionView
            x:Name="fileCollection"
            Grid.Row="2"
            SelectedItems="{Binding SelectedFiles}"
            SelectionChangedCommand="{Binding FileSelectionChangedCommand}"
            SelectionMode="Multiple"
            ItemsSource="{Binding PoolFiles}">
            <CollectionView.ItemsLayout>
                <GridItemsLayout
                    HorizontalItemSpacing="10"
                    Orientation="Vertical"
                    Span="4"
                    VerticalItemSpacing="10" />
            </CollectionView.ItemsLayout>
            <CollectionView.ItemTemplate>
                <DataTemplate x:DataType="model:FileMetadata">
                    <Grid
                        ColumnDefinitions="Auto,Auto,*"
                        RowDefinitions="Auto,Auto,Auto"
                        RowSpacing="2">
                        <Image
                            Grid.Row="0"
                            Grid.RowSpan="3"
                            Grid.Column="0"
                            HeightRequest="70"
                            Source="{Binding ThumbnailSource}"
                            WidthRequest="70" />
                        <Label
                            Grid.Row="0"
                            Grid.Column="1"
                            Grid.ColumnSpan="2"
                            FontSize="20"
                            HorizontalOptions="Start"
                            LineBreakMode="TailTruncation"
                            Text="{Binding Filename}" />
                        <Label
                            Grid.Row="1"
                            Grid.Column="1"
                            FontSize="12"
                            HorizontalOptions="Start"
                            Text="{Binding FormattedSize}" />
                        <Label
                            Grid.Row="1"
                            Grid.Column="2"
                            FontSize="12"
                            HorizontalOptions="End"
                            IsVisible="{Binding IsDownloading}"
                            Text="{Binding FormattedDownloadedSize}"
                            VerticalOptions="Center" />
                        <HorizontalStackLayout
                            Grid.Row="2"
                            Grid.Column="1"
                            HorizontalOptions="Start">
                            <Border
                                Background="Transparent"
                                HeightRequest="25"
                                HorizontalOptions="Start"
                                Stroke="SkyBlue"
                                StrokeShape="RoundRectangle 25"
                                StrokeThickness="3"
                                WidthRequest="25">
                                <Image Aspect="AspectFit" Source="user.png" />
                            </Border>
                            <Label
                                FontSize="12"
                                HorizontalOptions="Start"
                                LineBreakMode="TailTruncation"
                                Text="{Binding Owner.Username}"
                                TextColor="{StaticResource Grad1}" />
                        </HorizontalStackLayout>
                        <Border
                            Grid.Row="0"
                            Grid.RowSpan="3"
                            Grid.Column="0"
                            Grid.ColumnSpan="3"
                            IsVisible="{Binding IsDownloading}"
                            Stroke="Transparent"
                            StrokeShape="RoundRectangle 10">
                            <Border.Background>
                                <LinearGradientBrush>
                                    <GradientStop Offset="0" Color="{StaticResource Grad1Back}" />
                                    <GradientStop Offset="1" Color="{StaticResource Grad2Back}" />
                                </LinearGradientBrush>
                            </Border.Background>
                        </Border>
                        <Border
                            Grid.Row="0"
                            Grid.RowSpan="3"
                            Grid.Column="0"
                            Grid.ColumnSpan="3"
                            AnchorX="0"
                            ScaleX="{Binding DownloadProgress}"
                            Stroke="Transparent"
                            StrokeShape="RoundRectangle 10">
                            <Border.Background>
                                <LinearGradientBrush>
                                    <GradientStop Offset="0" Color="{StaticResource Grad1Fade}" />
                                    <GradientStop Offset="1" Color="{StaticResource Grad2Fade}" />
                                </LinearGradientBrush>
                            </Border.Background>
                        </Border>
                        <!--
                        <Image
                            Grid.Row="0"
                            Grid.Column="0"
                            Grid.RowSpan="3"
                            HorizontalOptions="Center"
                            VerticalOptions="Center"
                            Scale="0"
                            WidthRequest="30"
                            Source="eye.png">
                            <Image.GestureRecognizers>
                                <PointerGestureRecognizer
                                    PointerEntered="OnpreviewPointerEntered"
                                    PointerExited="OnPreviewPointerExited" />
                            </Image.GestureRecognizers>
                        </Image>
                        <Image
                            x:Name="markIndicator"
                            Grid.Row="0"
                            Grid.Column="2"
                            HorizontalOptions="End"
                            VerticalOptions="Center"
                            WidthRequest="20"
                            Source="check.png" />
                        <Image
                            x:Name="downloadIndicator"
                            IsVisible="{Binding IsDownloaded}"
                            Grid.Row="2"
                            Grid.Column="2"
                            HorizontalOptions="End"
                            VerticalOptions="Center"
                            WidthRequest="20"
                            Source="download.png" />
                        -->
                    </Grid>
                </DataTemplate>
            </CollectionView.ItemTemplate>
        </CollectionView>
        <Grid
            Grid.Row="3"
            ColumnDefinitions="*,*,*"
            ColumnSpacing="20">
            <Button
                x:Name="addFilesBtn"
                Grid.Column="0"
                Margin="0,10,0,0"
                Command="{Binding ClickAddFilesBtnCommand}"
                FontSize="15"
                Text="Add files"
                TextColor="White">
                <Button.ImageSource>
                    <FontImageSource
                        FontFamily="FASolid"
                        Glyph="&#xe494;"
                        Size="20"
                        Color="{AppThemeBinding Light={StaticResource White},
                                                Dark={StaticResource PrimaryDarkText}}" />
                </Button.ImageSource>
            </Button>
            <Button
                x:Name="saveToCloudBtn"
                Grid.Column="1"
                Margin="0,10,0,0"
                FontSize="15"
                IsEnabled="false"
                Text="Save to cloud"
                TextColor="White">
                <Button.ImageSource>
                    <FontImageSource
                        FontFamily="FASolid"
                        Glyph="&#xf0ed;"
                        Size="20"
                        Color="White" />
                </Button.ImageSource>
            </Button>
            <Button
                x:Name="downloadBtn"
                Grid.Column="2"
                Margin="0,10,0,0"
                Command="{Binding ClickDownloadBtnCommand}"
                FontSize="15"
                IsEnabled="{Binding IsDownloadEnabled}"
                Text="Save"
                TextColor="White">
                <Button.ImageSource>
                    <FontImageSource
                        FontFamily="FASolid"
                        Glyph="&#xf019;"
                        Size="20"
                        Color="White" />
                </Button.ImageSource>
            </Button>

        </Grid>
    </Grid>
</ContentPage>